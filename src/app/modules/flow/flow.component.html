<div class="flow-layout">

  <section class="flow-layout__left">
    <fiiz-tab-nav [items]="[{key: 'notes', label: 'Notes'}, {key: 'timeline', label: 'Timeline'}]" (onSelect)="$event === 'notes' ? tabIndex = 1 : tabIndex = 0 "></fiiz-tab-nav>
    <ng-container *ngTemplateOutlet="tabIndex ? flowNotes : flowTimeline"></ng-container>
  </section>

  <section [@slide]="animationIndex" class="flow-layout__content">
    <div class="flow-layout__floating">
      <fiiz-dropdown type="button" (onClick)="handleFabAction($event)" [items]="menuItems" position="bottom-right"></fiiz-dropdown>
    </div>

    <ng-template flowHost></ng-template>

    <div class="flow-layout__content__controls">
      <fiiz-button (click)="onBack($event)" stroked *ngIf="(stepHistory$ | async)?.length > 0">Back</fiiz-button>
      <fiiz-button *ngIf="!!flowService.findNextStep()" type="submit" [disabled]="!(valid$ | async)" primary (click)="onNext($event)" style="margin-left: auto;">Next</fiiz-button>
    </div>

  </section>

<!--  <section class="flow-layout__right">-->
<!--&lt;!&ndash;    <fiiz-dropdown type="button" (onClick)="handleFabAction($event)" [items]="menuItems" position="bottom-right"></fiiz-dropdown>&ndash;&gt;-->
<!--    <ng-container *ngTemplateOutlet="flowNotes"></ng-container>-->
<!--    <fiiz-select [items]="objections$" label="Objection"></fiiz-select>-->
<!--    <fiiz-button warning class="full-width" style="align-self: flex-end;" stroked (click)="endCall()">End Call</fiiz-button>-->
<!--  </section>-->

</div>

<ng-template #flowNotes>
  <div>
    <editor
      apiKey="urnz0s9a4al78qoc2vppvb448lleii59pbarcr4cgviahk1i"
      outputFormat="html"
      #tinymce
      *ngIf="flowService.noteId"
      [initialValue]="(notes$ | async)"
      [(ngModel)]="notesData"
      [init]="tinymceOptions"
    ></editor>
    <div *ngIf="!flowService.noteId" style="text-align: center;padding: 20px 0; opacity: .5;">Awaiting an active call.</div>
  </div>
</ng-template>

<ng-template #flowTimeline>
  <flow-timeline (onSelect)="goTo($event)"></flow-timeline>
</ng-template>
