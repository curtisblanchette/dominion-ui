<form [formGroup]="searchForm" class="list-actions">
  <div class="list-actions__controls">
    <fiiz-input #SearchInput icon="fa-search" formControlName="search" type="text"
                placeholder="Search {{pluralModuleName}}..."></fiiz-input>
    <fiiz-dropdown
      type="button"
      *ngIf="options.editable"
      [items]="actionItems"
      position="bottom-right"
      title="Actions"></fiiz-dropdown>
    <fiiz-button stroked (click)="onCreateNew()">Create New {{moduleName}}</fiiz-button>
  </div>
</form>

<div class="flex-table">
  <div class="flex-table__header">
    <div class="flex-table__cell" style="flex: 0.2;">&nbsp;</div>
    <div class="flex-table__cell sortable"
         [ngClass]="sortOrgColumn === column.id && {
            'sort__asc': sortDirection === sortDirections.ASC,
            'sort__desc': sortDirection === sortDirections.DESC
         }"
         (click)="sortListBy(column.id)"
         *ngFor="let column of columns">
      {{column.label}}
    </div>
  </div>
  <div class="flex-table__body">

    <ng-container [ngTemplateOutlet]="main" *ngIf="(loaded$ | async) && (data$ | async)?.length"></ng-container>
    <ng-container [ngTemplateOutlet]="loading" *ngIf="loading$ | async"></ng-container>
    <ng-container [ngTemplateOutlet]="noDataFound" *ngIf="(loaded$ | async) && (data$ | async)?.length == 0"></ng-container>
    <ng-container [ngTemplateOutlet]="initial" *ngIf="!(loaded$ | async) && !(loading$ | async)"></ng-container>

  </div>
  <div class="flex-table__footer">
    <div class="per-page">
      Per Page: <fiiz-select size="small" [items]="perPageOptions$" (change)="onPerPageChange($event)" [ngModel]="perPage$ | async"></fiiz-select>
    </div>

    <pagination-controls
      previousLabel="Prev"
      nextLabel="Next"
      responsive="true"
      directionLinks="true"
      autoHide="true"
      screenReaderPaginationLabel="Pagination"
      screenReaderPageLabel="page"
      screenReaderCurrentLabel="You're on page"
      maxSize="5"
      (pageChange)="handlePageChange($event)">
    </pagination-controls>
  </div>
</div>

<ng-template #loading>
  <fiiz-loading type="ripple"></fiiz-loading>
</ng-template>

<ng-template #noDataFound>
  <div class="message-block" style="padding-top: 5%;">
    We could not find a {{moduleName}} with the term "{{searchForm.value.key}}"
  </div>
  <div class="message-block">
    <span>Try another search term or create a new {{moduleName}}.</span>
  </div>
  <div class="message-block" style="padding-top: 4%;">
    <fiiz-button stroked (click)="onCreateNew()">Create New {{moduleName}}</fiiz-button>
  </div>
</ng-template>

<ng-template #initial>
  <div class="message-block" style="padding-top: 5%;">
    Search {{ pluralModuleName }}
  </div>
  <div class="message-block">
    <span>You can search by name, phone number or email.</span>
  </div>
</ng-template>

<ng-template #main>

      <div class="flex-table__row active"
           [ngClass]="{'active' : selected?.id === item?.id}"
           tabindex="0" #row
           (mousedown)="onClick($event, item)"
           (focusin)="onFocusIn($event, item)"
           (focusout)="onFocusOut($event)"
           *ngFor="let item of data$ | async | paginate: { itemsPerPage: perPage, currentPage: page, totalItems: count$ | async } ">
        <div class="flex-table__cell" style="flex: 0.2; justify-content:space-around;">

          <input name="recordId" id="{{item.id}}" [checked]="selected?.id === item?.id" [value]="item?.id" type="radio">
          <span class="customRadio"></span>

        </div>
        <div class="flex-table__cell" *ngFor="let column of columns">
          <ng-container [ngSwitch]="(item[column.id] | typeOf)">
            <ng-container *ngSwitchCase="'date'">{{ item[column.id] | date }}</ng-container>
            <ng-container *ngSwitchCase="'string'">{{ item[column.id] }}</ng-container>
            <ng-container *ngSwitchCase="'uuid'">{{ item[column.id] }}</ng-container>
            <ng-container *ngSwitchCase="'object'">{{ item[column.id].name }}</ng-container>
          </ng-container>
        </div>

      </div>

</ng-template>
